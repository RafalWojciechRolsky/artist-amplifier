# Test Design: Story 3.4

**Date:** 2025-09-03
**Designer:** Quinn (Test Architect)

## Test Strategy Overview

- **Total test scenarios:** 8
- **Unit tests:** 2 (25%)
- **Integration tests:** 2 (25%)
- **E2E tests:** 4 (50%)
- **Priority distribution:** P0: 4, P1: 4, P2: 0, P3: 0

Strategia skupia się na testach E2E (End-to-End) w celu weryfikacji kompletnych przepływów użytkownika, które są kluczowe w tej historii. Testy jednostkowe zapewnią poprawność logiki maszyny stanów, a testy integracyjne sprawdzą poprawność kontraktów API.

## Test Scenarios by Acceptance Criteria

### AC 1, 2, 4, 5: User Feedback and State Transitions

| ID          | Level       | Priority | Test                                                 | Justification                                                       |
| :---        | :---        | :---     | :---                                                 | :---                                                                |
| 3.4-E2E-01  | E2E         | P0       | **Happy Path (Quick Analysis):** Weryfikuje, czy UI poprawnie pokazuje statusy `analyzing` -> `generating` -> `readyDescription`, przycisk jest zablokowany, a pole opisu pojawia się na końcu. | Weryfikacja głównego, najczęstszego przepływu użytkownika.           |
| 3.4-E2E-02  | E2E         | P1       | **Happy Path (Long Analysis with Polling):** Symuluje odpowiedź API z `jobId` i weryfikuje, czy UI przechodzi w stan `polling`, a następnie poprawnie kończy proces. | Zapewnia, że mechanizm odpytywania działa zgodnie z oczekiwaniami.     |
| 3.4-UNIT-01 | Unit        | P0       | **State Machine Transitions:** Sprawdza, czy `useReducer` w `page.tsx` poprawnie przechodzi między wszystkimi stanami (`idle`, `analyzing`, `polling`, `generating`, `readyDescription`, `error`) w odpowiedzi na akcje. | Kluczowa logika biznesowa jest w reducerze; musi być w 100% poprawna. |
| 3.4-INT-01  | Integration | P1       | **UI Component Props:** Weryfikuje, czy komponenty (`AnalysisStatus`, `GenerateButton`, `DescriptionPreview`) poprawnie renderują UI w odpowiedzi na różne stany przekazane w propsach. | Zapewnia, że poszczególne elementy UI reagują poprawnie na logikę stanu. |

### AC 3: Error Handling

| ID          | Level       | Priority | Test                                                 | Justification                                                       |
| :---        | :---        | :---     | :---                                                 | :---                                                                |
| 3.4-E2E-03  | E2E         | P0       | **API Failure (Analyze Step):** Symuluje błąd sieci lub odpowiedź 500 z API `/api/audio/analyze` i weryfikuje, czy `ErrorBanner` wyświetla poprawny komunikat. | Krytyczny scenariusz; użytkownik musi być poinformowany o błędzie.     |
| 3.4-E2E-04  | E2E         | P1       | **Polling Timeout:** Symuluje scenariusz, w którym odpytywanie trwa dłużej niż zdefiniowany timeout (2 minuty) i weryfikuje, czy pojawia się odpowiedni komunikat o błędzie. | Sprawdza odporność aplikacji na problemy z długo trwającymi zadaniami w tle. |
| 3.4-UNIT-02 | Unit        | P1       | **Error State in Reducer:** Sprawdza, czy akcja błędu (`{ type: 'ERROR', payload: ... }`) poprawnie ustawia stan błędu w reducerze. | Zapewnia, że logika obsługi błędów jest poprawna na poziomie stanu.   |
| 3.4-INT-02  | Integration | P0       | **API Error Contract:** Weryfikuje, czy klient API poprawnie parsuje i obsługuje błędy w formacie `ApiError` zwracane przez backend. | Zapewnia, że kontrakt między FE i BE w zakresie błędów jest dotrzymany. |
