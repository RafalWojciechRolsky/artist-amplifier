# Test Design: Story 2.2

Date: 2025-08-31
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 7
- Unit tests: 3 (43%)
- Integration tests: 2 (29%)
- E2E tests: 1 (14%)
- Manual tests: 1 (14%)
- Priority distribution: P0: 2, P1: 3, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1: Real description returned, AC2: Metadata populated, AC3: No breaking changes

| ID            | Level       | Priority | Test                                                                 | Justification                                                              |
| :------------ | :---------- | :------- | :------------------------------------------------------------------- | :------------------------------------------------------------------------- |
| 2.2-INT-001   | Integration | P0       | API returns `GeneratedDescription` on LLM service success              | Tests the integration of the API route and the LLM service (happy path).   |
| 2.2-UNIT-001  | Unit        | P0       | `generateDescription` function parses successful LLM response correctly | Tests the core logic of the new LLM service in isolation.                  |
| 2.2-UNIT-002  | Unit        | P1       | `generateDescription` function handles a 500 error from the LLM API     | Ensures the service is resilient to external API failures.                 |
| 2.2-UNIT-003  | Unit        | P1       | `generateDescription` function handles a 429 error and retries        | Validates the specific resilience mechanism required by the dev notes.     |
| 2.2-INT-002   | Integration | P1       | API returns `ApiError` when the LLM service throws an error            | Ensures the API maintains its error contract even when dependencies fail.  |
| 2.2-E2E-001   | E2E         | P1       | Full user flow from upload to generation works with a mocked LLM       | Provides confidence in the complete user journey.                          |

### AC4: Documentation is updated

| ID            | Level  | Priority | Test                                                              | Justification                                           |
| :------------ | :----- | :------- | :---------------------------------------------------------------- | :------------------------------------------------------ |
| 2.2-MANUAL-001| Manual | P2       | Verify `.env.example` and `README.md` contain the new variables. | Documentation updates require manual verification.      |

## Risk Coverage

| Risk ID  | Mitigating Test IDs                               |
| :------- | :------------------------------------------------ |
| TECH-001 | 2.2-INT-001, 2.2-UNIT-002, 2.2-UNIT-003, 2.2-INT-002 |
| DATA-001 | 2.2-UNIT-001                                      |
| OPS-001  | 2.2-MANUAL-001                                    |

## Recommended Execution Order

1.  P0 Unit tests (2.2-UNIT-001)
2.  P0 Integration tests (2.2-INT-001)
3.  P1 Unit tests (2.2-UNIT-002, 2.2-UNIT-003)
4.  P1 Integration tests (2.2-INT-002)
5.  P1 E2E tests (2.2-E2E-001)
6.  P2 Manual tests (2.2-MANUAL-001)
