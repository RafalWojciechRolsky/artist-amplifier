# Test Design: Story 1.3

Date: 2025-08-28
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 7 (39%)
- Integration tests: 7 (39%)
- E2E tests: 4 (22%)
- Priority distribution: P0: 7, P1: 8, P2: 3

## Test Scenarios by Acceptance Criteria

### AC1: Przycisk "Generuj opis" aktywny dopiero po spełnieniu warunków (Story 1.1 + 1.2)

#### Scenarios

| ID             | Level       | Priority | Test                                                                       | Justification                         |
| -------------- | ----------- | -------- | -------------------------------------------------------------------------- | ------------------------------------- |
| 1.3-UNIT-001   | Unit        | P1       | Validator enables button only when artist data + audio present             | Pure validation logic                  |
| 1.3-INT-001    | Integration | P1       | Page reducer reflects valid state to button disabled/enabled               | Component interaction                  |
| 1.3-E2E-001    | E2E         | P1       | User flow enables button after completing 1.1 fields + uploading audio     | Critical path UX                       |

### AC2: Sekwencja stanów: "Analiza audio..." → "Generowanie..."

#### Scenarios

| ID             | Level       | Priority | Test                                                                       | Justification                         |
| -------------- | ----------- | -------- | -------------------------------------------------------------------------- | ------------------------------------- |
| 1.3-UNIT-002   | Unit        | P1       | Reducer transitions: idle→analyzing→generating→readyDescription            | State machine logic                    |
| 1.3-INT-002    | Integration | P0       | Click triggers analysis call then LLM call in order                        | Multi-component flow                   |
| 1.3-E2E-002    | E2E         | P1       | UI shows progressive labels in correct order during slow backend           | Critical UX signaling                  |

### AC3: Wysyłka do API LLM: artistName, artistDescription, wynik analizy audio, szablon

#### Scenarios

| ID             | Level       | Priority | Test                                                                       | Justification                         |
| -------------- | ----------- | -------- | -------------------------------------------------------------------------- | ------------------------------------- |
| 1.3-UNIT-003   | Unit        | P0       | Payload builder constructs correct JSON contract                            | Pure transformation                    |
| 1.3-INT-003    | Integration | P0       | Route handler receives expected body; validates and forwards                | Contract focus                         |
| 1.3-INT-004    | Integration | P1       | Error mapping: provider errors → ApiError domain                            | Mapping logic                          |

### AC4: Wygenerowany tekst pojawia się w edytowalnym textarea

#### Scenarios

| ID             | Level       | Priority | Test                                                                       | Justification                         |
| -------------- | ----------- | -------- | -------------------------------------------------------------------------- | ------------------------------------- |
| 1.3-UNIT-004   | Unit        | P2       | TextEditor renders controlled textarea with accessibility attributes        | Component behavior                     |
| 1.3-INT-005    | Integration | P1       | After generation, state binds value to TextEditor                           | Component interaction                  |
| 1.3-E2E-003    | E2E         | P1       | User sees generated text, can select/copy                                   | User journey                           |

### AC5: Użytkownik może edytować tekst

#### Scenarios

| ID             | Level       | Priority | Test                                                                       | Justification                         |
| -------------- | ----------- | -------- | -------------------------------------------------------------------------- | ------------------------------------- |
| 1.3-UNIT-005   | Unit        | P1       | TextEditor onChange updates local state                                     | Component logic                        |
| 1.3-INT-006    | Integration | P1       | Edits persist to sessionStorage on change                                   | Integration with persistence           |

### AC6: Błąd analizy/generowania → komunikat i możliwość ponowienia

#### Scenarios

| ID             | Level       | Priority | Test                                                                       | Justification                         |
| -------------- | ----------- | -------- | -------------------------------------------------------------------------- | ------------------------------------- |
| 1.3-INT-007    | Integration | P0       | Analysis failure shows specific error + retry CTA                           | Recovery path                          |
| 1.3-INT-008    | Integration | P0       | Generation failure shows specific error + preserves user data               | Recovery + data safety                 |
| 1.3-E2E-004    | E2E         | P1       | End-to-end error then retry succeeds                                        | Critical resiliency                    |

### AC7: Stan utrzymany w sesji (odświeżenie nie resetuje postępu)

#### Scenarios

| ID             | Level       | Priority | Test                                                                       | Justification                         |
| -------------- | ----------- | -------- | -------------------------------------------------------------------------- | ------------------------------------- |
| 1.3-UNIT-006   | Unit        | P1       | Storage utility handles save/restore + quota errors                         | Logic/edge handling                    |
| 1.3-INT-009    | Integration | P1       | Refresh restores state including generated text and progress                 | Multi-component state                  |

### Cross-cutting (Cancel & A11y)

| ID             | Level       | Priority | Test                                                                       | Justification                         |
| -------------- | ----------- | -------- | -------------------------------------------------------------------------- | ------------------------------------- |
| 1.3-UNIT-007   | Unit        | P2       | Cancel action transitions to idle and aborts pending promise                 | State logic                            |
| 1.3-INT-010    | Integration | P1       | A11y: TextEditor ARIA roles/labels and keyboard interactions                 | Accessibility requirement              |

## Risk Coverage

- TECH-001 (API failures/timeouts) → 1.3-INT-007, 1.3-INT-008, 1.3-E2E-004
- PERF-001 (latency) → 1.3-E2E-002, 1.3-INT-002
- TECH-002 (analysis quality) → 1.3-UNIT-003, 1.3-INT-003, 1.3-INT-004
- BUS-001 (error messaging) → 1.3-INT-007, 1.3-INT-008
- DATA-001 (edit loss) → 1.3-INT-006, 1.3-INT-009
- SEC-001 (prompt injection) → 1.3-UNIT-003 (sanitization in payload), add negative cases in 1.3-INT-003
- OPS-001 (storage edge) → 1.3-UNIT-006

## Recommended Execution Order

1. P0 Unit tests (1.3-UNIT-003)
2. P0 Integration tests (1.3-INT-002, 1.3-INT-003, 1.3-INT-004, 1.3-INT-007, 1.3-INT-008)
3. P0 E2E tests (1.3-E2E-004)
4. Remaining P1 tests in order of ACs
5. P2 tests as time permits
