<!-- Powered by BMAD™ Core -->

# Macierz Śledzenia Wymagań: Story 1.2 – Przesyłanie Utworu do Analizy

- **Data**: 2025-08-27
- **Story**: [docs/stories/1.2.przesylanie-utworu-do-analizy.md](../../stories/1.2.przesylanie-utworu-do-analizy.md)
- **Test Design**: [docs/qa/assessments/1.2-przesylanie-utworu-do-analizy-test-design-20250827.md](./1.2-przesylanie-utworu-do-analizy-test-design-20250827.md)

## Podsumowanie Pokrycia

Ta macierz mapuje kryteria akceptacji (AC) dla Story 1.2 na konkretne scenariusze testowe (TC) zdefiniowane w dokumencie Test Design. Celem jest zapewnienie 100% pokrycia wymagań przez testy i zidentyfikowanie ewentualnych luk.

- **Całkowite pokrycie AC**: 7 z 7 (100%)
- **Liczba zmapowanych testów**: 20

## Macierz Śledzenia

| Kryterium Akceptacji (AC) | ID Testu | Scenariusz (Given-When-Then) | Poziom | Priorytet |
| :--- | :--- | :--- | :--- | :--- |
| **AC1**: Użytkownik może wskazać plik audio (.mp3/.wav, ≤ 50MB) i widzi jego nazwę. | TC1.1 | **Given** input akceptuje .mp3/.wav, ≤ 50MB<br>**When** użytkownik wybiera `song.mp3` (5MB)<br>**Then** widoczna jest nazwa pliku, a stan przechowuje referencję. | Integracja | P1 |
| | TC1.2 | **Given** input file<br>**When** użytkownik wybiera `malicious.exe`<br>**Then** pojawia się komunikat o błędnym formacie. | Unit | P0 |
| **AC2**: Natychmiastowa walidacja formatu/rozmiaru z czytelnym komunikatem. | TC2.1 | **Given** input z limitem 50MB<br>**When** użytkownik wybiera plik 60MB<br>**Then** pojawia się komunikat o przekroczeniu limitu. | Unit | P0 |
| | TC2.2 | **Given** funkcja walidacji typu<br>**When** plik `.mp3` ma błędny MIME type<br>**Then** walidacja zwraca błąd. | Unit | P0 |
| | TC2.3 | **Given** wystąpił błąd walidacji<br>**When** komunikat jest wyświetlany<br>**Then** jest on powiązany z inputem (aria-describedby) i ogłoszony (aria-live). | A11y | P1 |
| | TC2.4 | **Given** wyświetlany jest błąd walidacji<br>**When** użytkownik wybiera poprawny plik<br>**Then** komunikat o błędzie znika. | Integracja | P1 |
| **AC3**: Analiza startuje dopiero po kliknięciu "Generuj opis". | TC3.1 | **Given** wybrano poprawny plik<br>**When** użytkownik nie kliknął "Generuj opis"<br>**Then** analiza nie jest uruchamiana. | Integracja | P1 |
| | TC3.2 | **Given** wybrano poprawny plik<br>**When** użytkownik klika "Generuj opis"<br>**Then** wywoływane jest API analizy, a UI przechodzi w stan "Analiza". | E2E | P1 |
| **AC4**: Status "Analiza audio..." i możliwość przerwania. | TC4.1 | **Given** aplikacja jest w stanie `analyzing`<br>**When** UI jest renderowane<br>**Then** etykieta przycisku to "Analiza audio...", a inne akcje są zablokowane. | Integracja | P1 |
| | TC4.2 | **Given** trwa analiza (`analyzing`)<br>**When** użytkownik klika przycisk anulowania<br>**Then** UI wraca do stanu gotowości, a żądanie API jest przerywane. | Integracja | P1 |
| | TC4.3 | **Given** trwa analiza<br>**When** UI jest renderowane<br>**Then** nie jest widoczny pasek postępu, tylko status tekstowy. | UI | P3 |
| **AC5**: Obsługa błędów analizy i ponowienie próby. | TC5.1 | **Given** API dostawcy zwraca błąd<br>**When** błąd jest przechwytywany<br>**Then** UI wyświetla czytelny komunikat bez szczegółów technicznych. | Integracja | P1 |
| | TC5.2 | **Given** wystąpił błąd analizy<br>**When** użytkownik wybiera inny, poprawny plik i ponawia<br>**Then** proces przebiega pomyślnie. | E2E | P1 |
| | TC5.3 | **Given** API zwraca błąd przejściowy (np. timeout)<br>**When** mechanizm retry jest aktywny<br>**Then** próba jest ponawiana z backoffem. | Integracja | P1 |
| **AC6**: Wynik analizy jest odbierany i przechowywany w sesji. | TC6.1 | **Given** analiza zakończyła się sukcesem<br>**When** wynik jest odbierany<br>**Then** jest on zapisywany w `sessionStorage` pod kluczem `aa:v1:analysis:*`. | Unit | P1 |
| | TC6.2 | **Given** wynik analizy jest w `sessionStorage`<br>**When** rozpoczyna się generowanie opisu<br>**Then** dane z sesji są odczytywane i używane. | Integracja | P1 |
| | TC6.3 | **Given** API dostawcy zwraca odpowiedź z nietypową strukturą<br>**When** odpowiedź jest parsowana<br>**Then** parser jest odporny na brakujące/dodatkowe pola. | Unit | P1 |
| **AC7**: Interfejs prezentuje stany: "Gotowe", "Analiza", "Błąd". | TC7.1 | **Given** aplikacja jest w stanie `idle`<br>**When** użytkownik przechodzi przez cały proces<br>**Then** stany zmieniają się poprawnie: `idle` → `analyzing` → `error` / `completed`. | Integracja | P1 |
| | TC7.2 | **Given** stan aplikacji się zmienia<br>**When** UI jest aktualizowane<br>**Then** zmiana statusu jest ogłaszana przez czytnik ekranu. | A11y | P1 |

## Wnioski

- Wszystkie kryteria akceptacji mają przypisane co najmniej jeden scenariusz testowy, co potwierdza pełne pokrycie.
- Zidentyfikowane testy P0 (TC1.2, TC2.1, TC2.2) powinny być priorytetem w implementacji i wykonaniu, ponieważ mitygują krytyczne ryzyko bezpieczeństwa (SEC-001).
- Testy A11y (TC2.3, TC7.2) zapewniają zgodność z wymaganiami dostępności.
- Macierz jest gotowa do użycia w procesie Quality Gate jako dowód na pokrycie wymagań testami.
