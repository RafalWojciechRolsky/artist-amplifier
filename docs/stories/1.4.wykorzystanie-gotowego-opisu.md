# <!-- Powered by BMAD™ Core -->

# Story 1.4: Wykorzystanie Gotowego Opisu

## Status

Done

## Story

**As a** artysta,
**I want** w prosty sposób skopiować lub pobrać gotowy opis,
**so that** mogę go natychmiast użyć w swoich kanałach promocyjnych.

## Acceptance Criteria

1. Pod polem z wygenerowanym tekstem znajdują się dwa przyciski: "Kopiuj do schowka" i "Pobierz jako .txt".
2. Kliknięcie "Kopiuj do schowka" kopiuje całą zawartość pola tekstowego do schowka systemowego.
3. Po skopiowaniu, użytkownik widzi wizualne potwierdzenie (np. krótki komunikat "Skopiowano!").
4. Kliknięcie "Pobierz jako .txt" inicjuje pobranie pliku tekstowego o nazwie nazwa_artysty_opis.txt, zawierającego treść z pola tekstowego.
5. Kliknięcie "Reset" natychmiast czyści wszystkie dane w UI (pola formularza, wybrany plik, wygenerowany opis) oraz zapis w sessionStorage i przywraca aplikację do stanu początkowego (Krok 1).

## Tasks / Subtasks

- [x] Implement `ActionButtons.tsx` component (AC: 1)
  - [x] Add "Kopiuj do schowka" button.
  - [x] Add "Pobierz jako .txt" button.
  - [x] Add "Reset" button.
- [x] Implement "Kopiuj do schowka" functionality (AC: 2, 3)
  - [x] Create a utility function to copy text to the clipboard.
  - [x] Show a confirmation message after copying.
- [x] Implement "Pobierz jako .txt" functionality (AC: 4)
  - [x] Create a utility function to download text as a file.
  - [x] The filename should be `nazwa_artysty_opis.txt`.
- [x] Implement "Reset" functionality (AC: 5)
  - [x] Dispatch a `RESET` action on button click.
  - [x] The reducer should handle the `RESET` action to clear state and `sessionStorage`.
- [x] Integrate `ActionButtons.tsx` into `page.tsx`.
- [x] Write unit tests for the new components and utility functions.

## Dev Notes

### Kontekst architektoniczny i komponenty

- **Previous Story Insights**:
  - `sessionStorage` is used for state persistence with keys `aa:v1:*`.
  - A state machine in `page.tsx` manages UI state.
  - The generated description is available in the `readyDescription` state.
- **Component Specifications**:
  - Create a new component `src/components/ActionButtons.tsx` to hold the "Kopiuj do schowka", "Pobierz jako .txt", and "Reset" buttons. [Source: docs/architecture/6-components.md]
  - The `ResetButton` component is mentioned in the architecture. [Source: docs/architecture/6-components.md#62-frontend-react-nextjs-app-router]
- **File Locations**:
  - New component in `src/components/ActionButtons.tsx`.
  - Logic for copy and download could be in a new file `src/lib/utils.ts`.
  - The main screen is `src/app/page.tsx`. [Source: docs/architecture/source-tree.md]
- **State Management**:
  - The "Reset" button should dispatch a `RESET` action to the reducer in `src/app/page.tsx`.
  - The `RESET` action should clear `sessionStorage` and reset the state to `idle`. [Source: docs/architecture/10-frontend-architecture.md#103-zarzdzanie-stanem]
- **Core Workflows**:
  - The Copy/Download/Reset workflow is described in `docs/architecture/8-core-workflows-mermaid-sequence.md#83-copydownloadreset-edit-loop`.

## Testing

- Jednostkowe: komponenty UI, obsługa stanów, zapis/odczyt danych z sessionStorage [Source: docs/architecture/10-frontend-architecture.md#108-testy-mvp]
- Integracyjne: cały przepływ generowania i edycji opisu [Source: docs/architecture/10-frontend-architecture.md#108-testy-mvp]
- Testy ułożone w katalogu `__tests__` obok testowanych komponentów [Source: docs/architecture/10-frontend-architecture.md#108-testy-mvp]

## Change Log

| Date       | Version | Description                 | Author             |
| ---------- | ------- | --------------------------- | ------------------ |
| 2025-08-28 | 1.0     | Initial draft for Story 1.4 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

Cascade (executed on 2025-08-29 06:29 CEST)

### Debug Log References

Relevant tests and setup demonstrating implementation and fixes:

- `src/components/__tests__/ActionButtons.test.tsx`
- `src/app/__tests__/page.integration.test.tsx`
- `src/lib/__tests__/utils.test.ts`
- `jest.setup.ts`

### Completion Notes List

- Implemented clipboard, download, and reset buttons in `ActionButtons` with confirmation state.
- Added `sanitizeFilename`, `buildDescriptionFilename`, `copyToClipboard`, `downloadTextFile` in `src/lib/utils.ts`.
- Wired `RESET` action and `handleReset` in `src/app/page.tsx` to clear state and sessionStorage; avoided persisting empty values post-reset.
- Integrated `ActionButtons` below the generated description editor.
- Wrote unit and integration tests; fixed lints; all tests passing locally (50/50).

### File List

- Modified: `src/app/page.tsx`
- Added: `src/components/ActionButtons.tsx`
- Added tests: `src/components/__tests__/ActionButtons.test.tsx`
- Modified tests: `src/app/__tests__/page.integration.test.tsx`
- Added/Modified utils: `src/lib/utils.ts`, `src/lib/__tests__/utils.test.ts`

## QA Results

### Review Date: 2025-08-29

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Implementation meets ACs with clear separation of concerns:

- `ActionButtons.tsx` correctly renders Copy/Download/Reset and guards disabled state when text is empty (AC 1, 2, 4, 5).
- `copyToClipboard()` prioritizes `navigator.clipboard.writeText` with a reliable textarea fallback; tests cover both paths (AC 2, 3).
- Visual confirmation "Skopiowano!" shown with `aria-live="polite"` (AC 3, accessibility OK).
- `downloadTextFile()` creates a text/plain Blob and triggers download; filename via `buildDescriptionFilename()` matches `nazwa_artysty_opis.txt` (AC 4).
- Reset flow clears sessionStorage and UI state via `RESET` action and dedicated storages (AC 5).

### Refactoring Performed

None during review. Code is maintainable and tested. Minor suggestions listed below.

### Compliance Check

- Coding Standards: ✓
- Project Structure: ✓ (src/components/, src/lib/, tests colocated in **tests**/)
- Testing Strategy: ✓ (unit + integration; reset and clipboard behaviors verified)
- All ACs Met: ✓

### Improvements Checklist

- [ ] Consider extracting the 1500ms feedback duration into a constant (e.g., UI_TIMING.COPIED_MS) to centralize UX timings.
- [ ] Optionally add an e2e test covering real clipboard behavior in a browser environment (beyond JSDOM), if scope requires.
- [ ] Consider memoizing filename computation if download can be triggered frequently (micro-opt; not required now).

### Security Review

PASS. Client-only clipboard/download; no sensitive data handling. No external I/O.

### Performance Considerations

PASS. O(1) UI actions; Blob lifecycle handled with URL.revokeObjectURL.

### Files Modified During Review

None.

### Gate Status

Gate: PASS → docs/qa/gates/1.4-wykorzystanie-gotowego-opisu.yml
Risk profile: docs/qa/assessments/1.4-risk-20250829.md (not generated in this review)
NFR assessment: docs/qa/assessments/1.4-nfr-20250829.md (not generated in this review)

### Recommended Status

[✓ Ready for Done]
