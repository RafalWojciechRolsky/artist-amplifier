# <!-- Powered by BMADâ„¢ Core -->

# Story 2.4: Walidacja ENV + README + minimalny smoke w CI

## Status

Draft

## Story

**As a** developer,
**I want** the application to have robust environment variable validation and a CI workflow,
**so that** the application is stable, and the setup is well-documented and automated.

## Acceptance Criteria

1.  The application validates required environment variables at runtime and provides clear error messages if they are missing.
2.  The `.env.example` and `README.md` files are updated to include all necessary environment variables for the Music.ai and LLM integrations.
3.  A basic CI workflow is implemented that runs linting, tests, and the build process on every pull request.
4.  The CI workflow passes successfully.

## Dev Notes

### Previous Story Insights

- **Asynchronous Flow**: Story 2.1 established an async flow (`/api/audio/analyze` -> `/api/audio/analyze/status`). This must be considered for any E2E smoke tests. [Source: Story 2.1 `Dev Agent Record`]
- **LLM Integration**: Story 2.2 added the LLM integration, which also needs to be covered by environment variable checks. [Source: Story 2.2 `Dev Agent Record`]

### API Specifications

- **Error Handling**: Missing environment variables should result in a standard `ApiError` with a 500 status code and a clear message. [Source: docs/architecture/coding-standards.md]

### File Locations

- **Environment Validation**: A centralized module for environment variables should be used, such as `src/lib/server/env.ts`. [Source: docs/architecture/coding-standards.md]
- **CI Workflow**: The CI workflow should be defined in `.github/workflows/ci.yml`. [Source: docs/architecture/14-deployment-architecture.md]

### Technical Constraints

- **Environment Variables**: The following environment variables must be validated: `MUSIC_AI_API_KEY`, `MUSIC_AI_WORKFLOW_ANALYZE`, `LLM_API_KEY`, `LLM_MODEL`. [Source: docs/prd/epic-2/epic-2-integracje-i-ui.md]

## Tasks / Subtasks

- [ ] **Task 1: Implement Environment Variable Validation** (AC: 1)
  - [ ] Create or update a server-side module (e.g., `src/lib/server/env.ts`) to validate the presence of required environment variables.
  - [ ] Integrate this validation into the BFF startup or at the beginning of each API route handler.
  - [ ] Ensure that missing variables cause the application to fail gracefully with a clear error message.
- [ ] **Task 2: Update Documentation** (AC: 2)
  - [ ] Update `.env.example` to include all required variables for Music.ai and LLM integrations.
  - [ ] Update `README.md` to provide clear instructions on how to configure these variables.
- [ ] **Task 3: Create CI Workflow** (AC: 3, 4)
  - [ ] Create a new GitHub Actions workflow file at `.github/workflows/ci.yml`.
  - [ ] Configure the workflow to trigger on pull requests.
  - [ ] Add steps to check out the code, set up Node.js, install dependencies, run linting, run tests, and run the build.
  - [ ] (Optional) Add a simple smoke test step.
- [ ] **Task 4: Testing** (AC: 1, 3, 4)
    - [ ] Add unit tests for the environment variable validation logic.
    - [ ] Manually verify that the CI workflow runs and passes on a test pull request.

## Change Log

| Date       | Version | Description                 | Author             |
| ---------- | ------- | --------------------------- | ------------------ |
| 2025-09-01 | 1.0     | Initial draft for Story 2.4 | Bob (Scrum Master) |
