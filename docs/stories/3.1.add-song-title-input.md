# <!-- Powered by BMADâ„¢ Core -->

# Story 3.1: Add Song Title Input

## Status

Ready to Review

## Story

**As a** user,
**I want** to provide a title for my song,
**so that** it can be clearly identified throughout the analysis and in the final description.

## Acceptance Criteria

1.  A new text input field labeled "Song Title" is added to the main form.
2.  The "Song Title" field is required.
3.  The entered song title is sent to the backend along with the other artist and audio information.
4.  The backend associates the song title with the analysis job.
5.  The song title is used in the prompt for generating the final description.

## Dev Notes

### API Specifications

- **Endpoint Modification**: The `POST /api/audio/generate` endpoint needs to be updated to accept the `songTitle` in its JSON payload. [Source: docs/architecture/5-api-specification.md]
- **Data Flow**: The `songTitle` will be passed from the frontend to the `/api/audio/generate` endpoint. The backend will then include this title when formulating the prompt for the LLM. [Source: docs/architecture/11-backend-architecture-opcjonalny-bff.md]

### Data Models

- **`ArtistInput`**: The `ArtistInput` interface in `src/lib/types.ts` should be updated to include `songTitle: string`. [Source: docs/architecture/4-data-models.md]

### File Locations

- **Frontend**:
  - `src/app/page.tsx`: Add the new input field to the main form. [Source: docs/architecture/source-tree.md]
  - `src/components/ArtistForm.tsx`: This component will likely house the new input field. [Source: docs/architecture/10-frontend-architecture.md]
  - `src/lib/api/generate.ts`: Update the API client to send the `songTitle`. [Source: docs/architecture/10-frontend-architecture.md]
- **Backend**:
  - `src/app/api/audio/generate/route.ts`: Update the route handler to receive the `songTitle` and pass it to the LLM service. [Source: docs/architecture/11-backend-architecture-opcjonalny-bff.md]
  - `src/lib/server/llm.ts`: Update the LLM service to include the `songTitle` in the prompt. [Source: docs/architecture/11-backend-architecture-opcjonalny-bff.md]

### Testing Requirements

- **Unit Tests**:
  - Update unit tests for the `ArtistForm` component to cover the new input field and its validation.
  - Update unit tests for the `/api/audio/generate` endpoint to verify that the `songTitle` is correctly received and used.
- **E2E Tests**: Update E2E smoke tests to include filling out the new "Song Title" field. [Source: docs/architecture/coding-standards.md]

## Tasks / Subtasks

- [x] **Task 1: Frontend Implementation** (AC: 1, 2, 3)
  - [x] Update the `ArtistInput` type in `src/lib/types.ts` to include `songTitle`.
  - [x] Add a new required text input field for "Song Title" in the `ArtistForm.tsx` component.
  - [x] Update the state management in `page.tsx` to handle the new `songTitle` field.
  - [x] Modify the `generate` function in `src/lib/api/generate.ts` to include the `songTitle` in the payload to the backend.
- [x] **Task 2: Backend Implementation** (AC: 4, 5)
  - [x] Update the `POST /api/audio/generate/route.ts` handler to accept the `songTitle` from the request body.
  - [x] Modify the `generateDescription` function in `src/lib/server/llm.ts` to incorporate the `songTitle` into the LLM prompt.
- [ ] **Task 3: Testing**
  - [x] Update or create unit tests for the `ArtistForm` component.
  - [x] Update or create unit tests for the `/api/audio/generate` route handler.
  - [ ] Update E2E tests to include the new field.

## Change Log

| Date       | Version | Description                 | Author             |
| ---------- | ------- | --------------------------- | ------------------ |
| 2025-09-01 | 1.0     | Initial draft for Story 3.1 | Bob (Scrum Master) |
